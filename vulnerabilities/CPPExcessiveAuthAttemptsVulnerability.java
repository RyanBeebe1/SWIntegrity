import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;

public class CPPExcessiveAuthAttemptsVulnerability implements Vulnerability{

	public boolean found = false;
	public boolean authAttempt = false;
	
	@Override
	public List<Integer> run(Analyzer ana) {
		CppAnalyzer cana = (CppAnalyzer) ana;
		List<Integer> lines = new ArrayList<>();
		for (HashMap.Entry<Integer, String> k : cana.getNumToLine().entrySet()) {
			if (authAttempt == false && (k.getValue().contains("username") || k.getValue().contains("password"))) {
				authAttempt = true;
			}
			else if (authAttempt == true && k.getValue().contains("int maxAttempts")){
				found = true;
			}
		}
		if (authAttempt == true && found == true) {
			return lines;
		}
		else {
			lines.add(1);
			return lines;
		}
	}
}
