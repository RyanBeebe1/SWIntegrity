import java.util.*;

/**
 * Created by beeber8 on 11/8/18.
 * Contains the code for the Java implementation of the Hard-coded Credentials Vulnerability.
 * CWE-798: http://cwe.mitre.org/top25/#CWE-798
 * 
 * @author Ryan Beebe
 * 
 * <p>: Parses through the file looking for places where credentials are hard coded using a variable or string. </p>
 */
public class JavaHardCodedCredentialsVulnerability implements Vulnerability{

    @Override
    public List<Integer> run(Analyzer ana) {
        JavaAnalyzer jana = (JavaAnalyzer) ana;
        List<Integer> lines = new ArrayList<>();
        for (HashMap.Entry<Integer, String> k : jana.getLineToLine().entrySet()) {
            if (k.getValue().contains("DriverManager.getConnection(url, \"")) {
                lines.add(k.getKey());
            }
            for (JavaAnalyzer.Variable v : jana.getVariables()) {
                if (k.getValue().replaceAll("\\s", "").contains("webapp.ldap.username=" + v.getName()) ||
                        k.getValue().replaceAll("\\s", "").contains("webapp.ldap.password=" + v.getName())) {
                    lines.add(k.getKey());
                }
            }
        }
        Collections.sort(lines);
        return lines;
    }
}
